#!/bin/sh
while ! grep -q 'Page Setup' /home/user/.config/evince/print-settings; do
  sleep 1
done
file=`grep -oP '(?<=file-name=).*' /home/user/.config/evince/print-settings`
pdffonts $file | grep -q 'Type 1C' && { echo 'Type 1' | sudo -u user my-notify; exit 1; } # FIXME: does it matter to use `exit 0' or `exit 1'?

( printf '\e%%-12345X'
  echo @PJL JOB
  if grep -q reverse=true /home/user/.config/evince/print-settings; then
    echo @PJL SET DUPLEX=ON
  fi
  echo @PJL ENTER LANGUAGE=POSTSCRIPT
  cat $file
  printf '\e%%-12345X'
  echo @PJL EOJ
  printf '\e%%-12345X'
) | send-to-printer | sudo -u user my-notify
